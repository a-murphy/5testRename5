resources:
  - name: nodeRepoResource4
    type: GitRepo
    configuration:
      gitProvider: aidan_github
      path: a-murphy/sample_node
      branches:
        include: master
  - name: gitRepoResource
    type: GitRepo
    configuration:
      gitProvider: aidan_github
      path: a-murphy/5testRename5
      branches:
        include: {{gitBranch}}
  - name: promotedBuildInfo
    type: BuildInfo
    configuration:
      sourceArtifactory:    artifactory
      buildName:  initial
      buildNumber: 1
  - name: helmBuildInfo
    type: BuildInfo
    configuration:
      sourceArtifactory:    artifactory
      buildName:  initial
      buildNumber: 1
  - name: helmBuildInfo2
    type: BuildInfo
    configuration:
      sourceArtifactory:    artifactory
      buildName:  initial
      buildNumber: 1
  - name: releaseBundle
    type: ReleaseBundle
    configuration:
      sourceDistribution:    distribution
      name: myRelease
      version: ${run_number}
  - name: helmChart
    type: HelmChart
    configuration:
      sourceArtifactory: artifactory
      repository: example-repo-local/test/
      chart: my chart
      version: v1.1.1
  - name: helmChart2
    type: HelmChart
    configuration:
      sourceArtifactory: artifactory
      repository: example-repo-local/test2/
      chart: my chart
      version: v1.1.12

pipelines:
  - name: webhook_pipeline
    steps:
      - name: helmPublish2
        type: HelmPublish
        configuration:
          chartPath: "my chart"
          flags: --debug
          autoPublishBuildInfo: true
          inputResources:
            - name: gitRepoResource
          outputResources:
            - name: helmChart2
            - name: helmBuildInfo2
      - name: promote
        type: PromoteBuild
        configuration:
          targetRepository: promoteRepository
          inputResources:
            - name: helmBuildInfo2
          outputResources:
            - name: promotedBuildInfo
      - name: helmPublish
        type: HelmPublish
        configuration:
          chartPath: "my chart"
          flags: --debug
          autoPublishBuildInfo: true
          inputResources:
            - name: gitRepoResource
            - name: promotedBuildInfo
          outputResources:
            - name: helmChart
            - name: helmBuildInfo
      - name: createReleaseBundle
        type: CreateReleaseBundle
        configuration:
          dryRun: false
          releaseBundleName: myReleaseBundle
          releaseBundleVersion: ${run_number}
          inputResources:
            - name: helmBuildInfo
            - name: promotedBuildInfo
          outputResources:
            - name: releaseBundle
 
